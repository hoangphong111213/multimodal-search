Loading CLIP model...
Loading Flickr30k dataset for image access...
Loading embeddings and metadata...
Loaded 31014 images with 512D embeddings
Building FAISS index...
FAISS index built with 31014 vectors

==================================================
TESTING BASIC SEARCH
==================================================

Query: 'a dog running in the park'
  1. File: image_4615.jpg - Score: 0.361 - The brown dog is walking along a grassy path with its tongue out.
  2. File: image_14572.jpg - Score: 0.351 - A golden dog is running across the grass chasing a white toy on the ground.
  3. File: image_30772.jpg - Score: 0.341 - A black and white dog runs on a dry, yellow field of grass.
  4. File: image_7079.jpg - Score: 0.341 - A little boy and a dog run down a hill, behind them, a boy on a mini cycle and a shouting family.
  5. File: image_13456.jpg - Score: 0.338 - A brown and white dog is jumping up to catch a ball in the park.

Query: 'people sitting on a beach'
  1. File: image_3471.jpg - Score: 0.328 - Two people sit in beach chairs with their child in front of them as waves come crashing in on a very sandy beach.
  2. File: image_682.jpg - Score: 0.317 - An asian family is picnicking at the beach while others play in the water.
  3. File: image_17066.jpg - Score: 0.315 - There are people sitting down on the ground in front of a gray beach.
  4. File: image_16553.jpg - Score: 0.314 - A group of men and women in swimwear sit on a beach in yoga poses.
  5. File: image_15327.jpg - Score: 0.314 - There are many people sitting or standing on sand, and there is a tractor.

Query: 'a red car on the street'
  1. File: image_23979.jpg - Score: 0.296 - Two people in red are riding their bicycles down a street next to a few cars.
  2. File: image_6599.jpg - Score: 0.292 - The back of two women looking down a street that has a pizzeria, a restaurant, several people, a black car, and two red cars.
  3. File: image_19953.jpg - Score: 0.289 - A damaged red car with the back glass completely taped over and a smashed fender sits parked on a public street.
  4. File: image_2377.jpg - Score: 0.288 - Two children are riding in a red play vehicle at a real gas station.
  5. File: image_9080.jpg - Score: 0.288 - An elderly person in bright orange overalls is standing along side a street.

Query: 'children playing football'
  1. File: image_16703.jpg - Score: 0.356 - Three little boys on the beach watching another boy kick a ball.
  2. File: image_13596.jpg - Score: 0.349 - Four boys playing a game with a soccer ball in front of a large set of ornate doors.
  3. File: image_30852.jpg - Score: 0.344 - Similarly dressed children are playing soccer in a rocky field in front of a building.
  4. File: image_4938.jpg - Score: 0.339 - The little girl sitting by the tree is looking away from the little boy kicking a soccer ball.
  5. File: image_25689.jpg - Score: 0.337 - A barefoot child wearing a blue shirt and a child wearing sandals with a red shirt both attempting to grab a soccer ball falling from the air.

==================================================
TRAINING RE-RANKER WITH VALIDATION
==================================================
Creating training, validation and test data for re-ranker...
Data split: 18000 train, 1000 val, 1000 test queries
Training: 72000 pairs (18000.0 positive)
Validation: 4000 pairs (1000.0 positive)
Test: 3999 pairs (1000.0 positive)
Training re-ranker with validation...
Epoch 5/30
  Train - Loss: 0.0638, Acc: 0.9791, F1: 0.9589
  Val   - Loss: 0.1336, Acc: 0.9473, F1: 0.8979
Epoch 10/30
  Train - Loss: 0.0292, Acc: 0.9918, F1: 0.9837
  Val   - Loss: 0.1290, Acc: 0.9530, F1: 0.9057
Epoch 15/30
  Train - Loss: 0.0160, Acc: 0.9964, F1: 0.9929
  Val   - Loss: 0.1468, Acc: 0.9490, F1: 0.8960
Epoch 20/30
  Train - Loss: 0.0123, Acc: 0.9972, F1: 0.9944
  Val   - Loss: 0.1578, Acc: 0.9490, F1: 0.8981
Epoch 25/30
  Train - Loss: 0.0073, Acc: 0.9989, F1: 0.9978
  Val   - Loss: 0.1651, Acc: 0.9485, F1: 0.8967
Epoch 30/30
  Train - Loss: 0.0062, Acc: 0.9987, F1: 0.9974
  Val   - Loss: 0.1705, Acc: 0.9507, F1: 0.9014

Best validation F1: 0.9057

Evaluating on test set...
Test Results:
  Loss: 0.1637
  Accuracy: 0.9537
  Precision: 0.9095
  Recall: 0.9050
  F1-Score: 0.9073

==================================================
TESTING WITH RE-RANKING
==================================================

Original top 5 results for: 'a dog running in the park'
  1. CLIP: 0.3608, File: image_4615.jpg - ReRank: 0.9915 - The brown dog is walking along a grassy path with its tongue out.
  2. CLIP: 0.3509, File: image_14572.jpg - ReRank: 0.9981 - A golden dog is running across the grass chasing a white toy on the ground.
  3. CLIP: 0.3414, File: image_30772.jpg - ReRank: 0.9753 - A black and white dog runs on a dry, yellow field of grass.
  4. CLIP: 0.3407, File: image_7079.jpg - ReRank: 0.8076 - A little boy and a dog run down a hill, behind them, a boy on a mini cycle and a shouting family.
  5. CLIP: 0.3382, File: image_13456.jpg - ReRank: 0.9980 - A brown and white dog is jumping up to catch a ball in the park.

Re-ranked top 5 results:
  1. CLIP: 0.3350, File: image_20079.jpg - ReRank: 0.9996 - A large furry brown dog is walking with a leash in his mouth.
  2. CLIP: 0.3357, File: image_1805.jpg - ReRank: 0.9994 - A black dog runs on green grass with its mouth open.
  3. CLIP: 0.3509, File: image_14572.jpg - ReRank: 0.9981 - A golden dog is running across the grass chasing a white toy on the ground.
  4. CLIP: 0.3382, File: image_13456.jpg - ReRank: 0.9980 - A brown and white dog is jumping up to catch a ball in the park.
  5. CLIP: 0.3340, File: image_1157.jpg - ReRank: 0.9980 - A yellow dog running through a grassy area carrying something small in its mouth.
Re-ranker saved to reranker.pth

Saved top 5 images for original ranking in 'test/original/'
Saved top 5 images for reranked results in 'test/rerank/'
